<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Long Text TTS Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 800px;
            width: 90%;
            margin: 20px;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
        }
        
        .status.loading {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status.ready {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .settings {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .setting-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        input[type="number"] {
            width: 80px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .progress {
            margin-top: 20px;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        
        .word-count {
            font-size: 14px;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }
        
        .example-texts {
            margin: 20px 0;
        }
        
        .example-btn {
            display: inline-block;
            padding: 8px 15px;
            margin: 5px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            color: #495057;
            text-decoration: none;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-btn:hover {
            background: #e9ecef;
            color: #333;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .settings {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé§ Long Text TTS</h1>
        <p class="subtitle">Convert unlimited text to high-quality speech using NeuTTS-Air</p>
        
        <div id="status" class="status loading">
            üîÑ Loading AI model... Please wait (this may take a few minutes on first run)
        </div>
        
        <div class="form-group">
            <label for="textInput">Enter your text (unlimited length):</label>
            <textarea id="textInput" placeholder="Paste your long text here... The system will automatically split it into optimal chunks for the best quality speech generation.

For example, you could paste:
- An entire article or blog post
- A research paper or academic content  
- A story or book chapter
- Meeting notes or presentation content

The system intelligently handles punctuation and sentence boundaries to create natural-sounding speech."></textarea>
            <div class="word-count" id="wordCount">0 words</div>
        </div>
        
        <div class="example-texts">
            <strong>Quick examples:</strong><br>
            <span class="example-btn" onclick="loadSampleText()">üìÑ Load Sample Academic Text</span>
            <span class="example-btn" onclick="loadShortText()">‚ö° Load Short Demo Text</span>
        </div>
        
        <div class="button-group">
            <button id="generateBtn" class="btn-primary" onclick="generateAudio()" disabled>
                üéµ Generate Speech Audio
            </button>
            <button class="btn-secondary" onclick="clearText()">
                üóëÔ∏è Clear Text
            </button>
        </div>
        
        <div id="progress" class="progress" style="display: none;">
            <div id="progressText">Processing...</div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
        </div>
    </div>

    <script>
        let modelReady = false;
        
        // Check model status on page load
        async function checkModelStatus() {
            try {
                const response = await fetch('/status');
                const data = await response.json();
                
                const statusDiv = document.getElementById('status');
                const generateBtn = document.getElementById('generateBtn');
                
                if (data.model_loaded) {
                    statusDiv.className = 'status ready';
                    statusDiv.innerHTML = '‚úÖ AI Model Ready - You can now generate speech!';
                    modelReady = true;
                    updateGenerateButton();
                } else {
                    statusDiv.className = 'status loading';
                    statusDiv.innerHTML = 'üîÑ Loading AI model... Please wait';
                    setTimeout(checkModelStatus, 3000); // Check again in 3 seconds
                }
            } catch (error) {
                const statusDiv = document.getElementById('status');
                statusDiv.className = 'status error';
                statusDiv.innerHTML = '‚ùå Error connecting to server. Please refresh the page.';
                setTimeout(checkModelStatus, 5000); // Check again in 5 seconds
            }
        }
        
        // Update word count and button state
        function updateWordCount() {
            const text = document.getElementById('textInput').value.trim();
            const wordCount = text ? text.split(/\s+/).length : 0;
            document.getElementById('wordCount').textContent = `${wordCount} words`;
            updateGenerateButton();
        }
        
        function updateGenerateButton() {
            const text = document.getElementById('textInput').value.trim();
            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = !modelReady || !text;
        }
        
        // Load sample texts
        function loadSampleText() {
            const sampleText = `Digital twins are virtual models designed to accurately reflect a physical object or system. These sophisticated digital replicas are created using real-time data from sensors, IoT devices, and other sources to mirror the behavior, performance, and condition of their physical counterparts. By integrating data from multiple sources, digital twins bridge the gap between physical and digital spaces, supporting applications such as predictive maintenance, performance optimization, and scenario simulation.

Remote photoplethysmography, commonly abbreviated as rPPG, is an innovative technology that allows for contactless monitoring of vital signs like heart rate and blood oxygen levels. This non-invasive method uses standard cameras to detect subtle color changes in human skin caused by blood circulation. The technology works by analyzing the slight variations in light reflection from the skin surface as blood flows through capillaries beneath.

The integration of digital twin technology with remote photoplethysmography opens up exciting possibilities in personalized healthcare. By creating a comprehensive digital model of a patient's physiological state, healthcare providers can simulate various treatment scenarios and predict outcomes with unprecedented accuracy.`;
            
            document.getElementById('textInput').value = sampleText;
            updateWordCount();
        }
        
        function loadShortText() {
            const shortText = "Hello! This is a demonstration of the long text speech generation system. Even though this is a shorter example, the system can handle much longer content like entire articles, research papers, or book chapters. The AI will maintain consistent voice quality throughout the entire text.";
            
            document.getElementById('textInput').value = shortText;
            updateWordCount();
        }
        
        function clearText() {
            document.getElementById('textInput').value = '';
            updateWordCount();
        }
        
        // Generate audio
        async function generateAudio() {
            const text = document.getElementById('textInput').value.trim();
            if (!text) {
                alert('Please enter some text first.');
                return;
            }
            const generateBtn = document.getElementById('generateBtn');
            const progressDiv = document.getElementById('progress');
            const progressText = document.getElementById('progressText');
            const progressFill = document.getElementById('progressFill');
            // Show progress
            generateBtn.disabled = true;
            progressDiv.style.display = 'block';
            progressText.textContent = 'Preparing to generate speech...';
            progressFill.style.width = '10%';
            try {
                progressText.textContent = 'Processing text and generating audio chunks...';
                progressFill.style.width = '30%';
                const response = await fetch('/synthesize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text
                    })
                });
                progressFill.style.width = '70%';
                if (response.ok) {
                    progressText.textContent = 'Finalizing audio file...';
                    progressFill.style.width = '90%';
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'long_text_audio.wav';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    progressText.textContent = '‚úÖ Audio generated successfully!';
                    progressFill.style.width = '100%';
                    setTimeout(() => {
                        progressDiv.style.display = 'none';
                        progressFill.style.width = '0%';
                    }, 3000);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Server error');
                }
            } catch (error) {
                progressText.textContent = `‚ùå Error: ${error.message}`;
                progressFill.style.width = '0%';
                console.error('Error:', error);
                setTimeout(() => {
                    progressDiv.style.display = 'none';
                }, 5000);
            } finally {
                generateBtn.disabled = false;
                updateGenerateButton();
            }
        }
        
        // Event listeners
        document.getElementById('textInput').addEventListener('input', updateWordCount);
        
        // Initial setup
        checkModelStatus();
        updateWordCount();
    </script>
</body>
</html>